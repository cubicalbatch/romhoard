{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RomHoard{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'favicon.png' %}">

    {% if USE_BUNDLED_ASSETS %}
    <!-- Bundled assets (Docker/offline mode) -->
    <link rel="stylesheet" href="{% static 'vendor/css/fonts.css' %}">
    <link rel="stylesheet" href="{% static 'css/tailwind.css' %}">
    <link rel="stylesheet" href="{% static 'css/retro.css' %}">
    <link rel="stylesheet" href="{% static 'vendor/css/glightbox.min.css' %}">
    <script src="{% static 'vendor/js/htmx-1.9.10.min.js' %}"></script>
    <script src="{% static 'vendor/js/glightbox.min.js' %}"></script>
    <script src="{% static 'js/alpine-app.js' %}?v=4"></script>
    <script defer src="{% static 'vendor/js/alpine-3.15.0.min.js' %}"></script>
    {% else %}
    <!-- CDN assets (development mode) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&family=VT323&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'css/retro.css' %}">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css">
    <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
    <script src="{% static 'js/alpine-app.js' %}?v=4"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.0/dist/cdn.min.js"></script>
    {% endif %}

    <!-- RomHoard Shared Utilities -->
    <script src="{% static 'js/romhoard-utils.js' %}"></script>

    {% block extra_head %}{% endblock %}
</head>
<body class="min-h-screen flex flex-col">
    <nav class="retro-nav" x-data="{ mobileOpen: false, searchQuery: new URLSearchParams(window.location.search).get('q') || '' }">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center h-16 gap-2 sm:gap-4">
                <!-- Brand -->
                <div class="flex-shrink-0">
                    <a href="/" class="retro-nav-brand"><span class="brand-rom">Rom</span><span class="brand-hoard">Hoard</span></a>
                </div>

                <!-- Global Search Bar (always visible) -->
                <div class="flex-1 flex items-center max-w-[180px] sm:max-w-xs lg:max-w-sm">
                    <form id="nav-search-form" action="{% url 'library:system_list' %}" method="GET" class="w-full relative">
                        <input type="text" name="q" id="nav-search"
                               x-model="searchQuery"
                               placeholder="Search..."
                               class="retro-input pl-7 pr-7 py-1.5 w-full text-xl"
                               autocomplete="off">
                        <!-- Search icon (left) -->
                        <svg class="absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 pointer-events-none text-[var(--color-text-muted)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <!-- Clear button -->
                        <button type="button" x-show="searchQuery" x-cloak
                                @click="searchQuery = ''; window.location.href = '{% url 'library:system_list' %}'"
                                class="absolute right-2 top-1/2 -translate-y-1/2 text-[var(--color-text-muted)] hover:text-[var(--color-text)] text-lg leading-none">
                            &times;
                        </button>
                    </form>
                </div>

                <!-- Desktop Nav Items -->
                <div class="hidden lg:flex lg:items-center lg:space-x-1 lg:ml-auto">
                    <a href="/" class="retro-nav-btn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h4v4H4V6zm6 0h4v4h-4V6zm6 0h4v4h-4V6zM4 14h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z" />
                        </svg>
                        Library
                    </a>
                    <a href="/collections/" class="retro-nav-btn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                        </svg>
                        Collections
                    </a>
                    <a href="/upload/" class="retro-nav-btn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                        </svg>
                        Upload
                    </a>
                    <a href="/scan/" class="retro-nav-btn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        Scan
                    </a>
                    <a href="/devices/" class="retro-nav-btn">
                        <svg fill="currentColor" viewBox="0 0 24 24">
                            <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                        </svg>
                        Devices
                    </a>
                    <a href="/settings/" class="retro-nav-btn">
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37 1 .608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        Settings
                    </a>
                </div>

                <!-- Mobile menu button -->
                <!-- Note: :class="active" keeps button visually pressed while menu is open - intentional effect, do not remove -->
                <div class="flex items-center lg:hidden ml-auto">
                    <button type="button" @click="mobileOpen = !mobileOpen" class="retro-btn retro-btn-sm" :class="{ 'active': mobileOpen }">
                        <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu panel -->
        <div x-show="mobileOpen" x-cloak class="lg:hidden border-t-2 border-[var(--color-border)] bg-[var(--color-nav-bg)]">
            <div class="py-2 space-y-1">
                <a href="/" class="retro-nav-btn-mobile">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h4v4H4V6zm6 0h4v4h-4V6zm6 0h4v4h-4V6zM4 14h4v4H4v-4zm6 0h4v4h-4v-4zm6 0h4v4h-4v-4z" />
                    </svg>
                    Library
                </a>
                <a href="/collections/" class="retro-nav-btn-mobile">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                    </svg>
                    Collections
                </a>
                <a href="/upload/" class="retro-nav-btn-mobile">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                    </svg>
                    Upload
                </a>
                <a href="/scan/" class="retro-nav-btn-mobile">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    Scan
                </a>
                <a href="/devices/" class="retro-nav-btn-mobile">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M21 6H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm-10 7H8v3H6v-3H3v-2h3V8h2v3h3v2zm4.5 2c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm4-3c-.83 0-1.5-.67-1.5-1.5S18.67 9 19.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                    </svg>
                    Devices
                </a>
                <a href="/settings/" class="retro-nav-btn-mobile">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37 1 .608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Settings
                </a>
            </div>
        </div>
    </nav>

    <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">
        {% block content %}{% endblock %}
    </main>

    <footer class="retro-footer mt-auto py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-[var(--color-text-muted)] text-base">
                <span class="retro-heading retro-heading-sm text-[var(--color-primary)]">RomHoard</span>
                <span class="mx-2">|</span>
                Self-hosted ROM library manager
            </p>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div x-data x-show="$store.toast.visible"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform translate-y-2"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-2"
         class="fixed bottom-20 left-1/2 transform -translate-x-1/2 z-[60]"
         x-cloak>
        <div class="retro-toast"
             :class="{
                 'retro-toast-success': $store.toast.type === 'success',
                 'retro-toast-error': $store.toast.type === 'error',
                 'retro-toast-info': $store.toast.type === 'info'
             }">
            <span x-text="$store.toast.message"></span><a x-show="$store.toast.link"
               :href="$store.toast.link"
               class="underline hover:no-underline font-semibold"
               x-text="$store.toast.linkText"></a>
            <button @click="$store.toast.hide()" class="ml-3 text-white/70 hover:text-white">&times;</button>
        </div>
    </div>

    <!-- Initialize base page functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            RomHoard.initBase('{{ csrf_token }}');
        });
    </script>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
